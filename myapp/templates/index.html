<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBCL</title>

    <script src="jquery-3.5.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous">
    </script>
</head>

<body>
    <div class="container mt-5"></div>
    <h2 class="text-center alert alert-danger"> Django Function Based Ajax </h2>

    <form id="search" method="POST" action="">
        <input type="text" class="form-control" id="se1" name="txtSearch" placeholder="Search"><br>
        <input type="button" class="btn btn-success" id="btnse" value="Submit">
    </form>
    <br>


    <div class="row">

        <div class="col-sm-4">

            <h4 class="text-center alert alert-info">Add/Update Empolyee Details</h4>

            <form action="" method="POST" id="insertForm">{% csrf_token %}
                Name:<input type="text" id="nameid" name="name"> <br>
                <br>
                Email:<input type="text" id="emailid" name="email"><br>
                <br>
                Password:<input type="text" id="passwordid" name="password">
                <br>
                <br>

                <input type="button" class="btn btn-success" id="btnsave" value="Save">
            </form>
            <br>
            <div id="msg" class="alert alert-success" style="display: none"></div>

        </div>
        <div class="col-sm-7">
            <h4 class="text-center alert alert-info">Show Empolyee Information</h4>
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Name</th>
                        <th scope="col">Email</th>
                        <th scope="col">Password</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody id="tbody">
                    <div id="del" class="alert alert-danger" style="display: none"></div>

                    {% for e in emp %}
                    <tr>
                        <td>{{e.id}}</td>
                        <td>{{e.name}}</td>
                        <td>{{e.email}}</td>
                        <td>{{e.password}}</td>
                        <td><a class="btn btn-success" href="{% url 'edit' %} {{e.id}}" role="button">Edit</a></td>
                        <td><input type="button" data-sid="{{e.id}}" class="btn btn-danger btn-sm dlbtn" value="Delete">
                        </td>

                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>


    <script>
        // for Insert data
        $("#btnsave").click(function () {
            output = "";
            // console.log("save button clicked");


            let nm = $("#nameid").val()
            let em = $("#emailid").val()
            let ps = $("#passwordid").val()
            if (nm == "") {
                console.log("error please enter Name")
            } else if (em == "") {
                console.log("error please enter Email")
            } else if (ps == "") {
                console.log("error please enter Password")
            } else {
                //console.log("nm");
                //console.log("em");
                //console.log("ps");
                mydata = {
                    name: nm,
                    email: em,
                    password: ps
                };
                $.ajax({
                    url: "{% url 'save' %}",
                    method: "POST",
                    data: mydata,
                    success: function (resp) {
                        x = resp.user_data;
                        if (resp.status == "save") {
                            $("#msg").text("Form Submitted Successfully");
                            $("#msg").show();
                            //console.log("x");

                            for (i = 0; i < x.length; i++) {
                                output += `
                                        <tr>
                                            <td>${x[i].id}</td>
                                            <td>${x[i].name}</td>
                                            <td>${x[i].email}</td>
                                            <td>${x[i].password}</td>
                                            <td><input type="button" data-sid="${x[i].id}" class="btn btn-warning btn-sm edbtn" value="Edit"></td>
                                            <td><input type="button" data-sid="${x[i].id}" class="btn btn-danger btn-sm dlbtn " value="Delete"></td>
                                        
                                        </tr>
                                `;
                            }
                            $("#tbody").html(output);

                        }
                        if (resp.status == 0) {
                            console.log("enable to saved form pls try Again ")
                        }
                    }

                });
            }
            $('#insertForm').trigger('reset'); //for blank  field after insert 

        });

        // for Delete data
        $("tbody").on("click", ".dlbtn", function () {
            console.log("delete button click");
            let id = $(this).attr("data-sid");
            console.log(id);
            mydata = {
                sid: id
            }
            mythis = this
            $.ajax({
                    url: "{% url 'delete' %}",
                    method: "POST",
                    data: mydata,
                    success: function (data) {
                        console.log(data);
                        if (data.status == 1) {
                            $("#del").text("Delete Submitted Successfully");
                            $("#del").show();
                            //console.log("Data Delete success");
                            $(mythis).closest("tr").fadeOut();
                        }
                        if (data.status == 0) {
                            console.log("Data not delete");
                        }

                    }
                }

            );
        });
    </script>


</body>

</html>